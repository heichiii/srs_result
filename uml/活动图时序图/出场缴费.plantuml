@startuml
actor 用户
participant "计费子系统" as 计费
participant "用户子系统" as 用户库
participant "值班员" as 值班员

用户  -> 出入子系统: 触发出场请求
出入子系统 --> 计费: 出场确认
计费 -> 用户库: 获取绑定信息
用户库 --> 计费: 返回用户信息
计费 -> 计费: 停止计时并生成订单
计费 -> 用户: 显示支付方式选项

alt 线上支付
  用户 -> 计费: 发起扫码支付
  计费 -> 第三方支付: 验证交易
  alt 支付成功
    第三方支付 --> 计费: 确认收款
    计费 -> 出入子系统: 抬杆放行
  else 支付失败
    计费 -> 计费: 标记订单异常
    计费 -> 值班员: 生成人工处理工单
    值班员 -> 用户: 现场核实处理
  end
else 现金支付
  用户 -> 值班员: 现金支付
  值班员 -> 计费: 手动确认收款
  计费 -> 出入子系统: 抬杆放行
end
@enduml